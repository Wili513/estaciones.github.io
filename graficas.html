<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gráficas de Sensores</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <nav>
    <a href="index.html">🏠 Inicio</a>
    <a href="lluvia.html">📊 Lluvia</a>
    <a href="lluvia_diaria.html">📅 Lluvia diaria</a>
    <a href="dht21.html">🌡️ DHT21</a>
    <a href="graficas.html">📈 Gráficas</a>
  </nav>

  <h2>Gráficas de Sensores</h2>

  <label for="selectorSensor">Selecciona un sensor:</label>
  <select id="selectorSensor">
    <option value="lluvia">Lluvia (mm)</option>
    <option value="temperatura">Temperatura (°C)</option>
    <option value="humedad">Humedad (%)</option>
  </select>

  <canvas id="grafico" style="margin-top:20px; max-height:400px;"></canvas>

  <script>
    const ctx = document.getElementById("grafico").getContext("2d");

    // Inicializar gráfico vacío
    let chart = new Chart(ctx, {
      type: 'line',
      data: { labels: [], datasets: [{ label: '', data: [], borderColor: 'blue', fill: false }] },
      options: { responsive: true }
    });

    function cargarDatos(sensor) {
      let etiquetas = [];
      let valores = [];

      if (sensor === "lluvia") {
        const historial = JSON.parse(localStorage.getItem("lluviaHistorial")) || [];
        etiquetas = historial.map(d => `${d.fecha} ${d.hora}`);
        valores = historial.map(d => parseFloat(d.valor) || 0);
        chart.data.datasets[0].label = "Lluvia (mm)";
        chart.data.datasets[0].borderColor = "blue";
      }
      else if (sensor === "temperatura") {
        const historial = JSON.parse(localStorage.getItem("dhtHistorial")) || [];
        etiquetas = historial.map(d => `${d.fecha} ${d.hora}`);
        valores = historial.map(d => parseFloat(d.temp) || 0);
        chart.data.datasets[0].label = "Temperatura (°C)";
        chart.data.datasets[0].borderColor = "red";
      }
      else if (sensor === "humedad") {
        const historial = JSON.parse(localStorage.getItem("dhtHistorial")) || [];
        etiquetas = historial.map(d => `${d.fecha} ${d.hora}`);
        valores = historial.map(d => parseFloat(d.hum) || 0);
        chart.data.datasets[0].label = "Humedad (%)";
        chart.data.datasets[0].borderColor = "green";
      }

      chart.data.labels = etiquetas;
      chart.data.datasets[0].data = valores;
      chart.update();
    }

    // Evento cambio de sensor
    document.getElementById("selectorSensor").addEventListener("change", e => {
      cargarDatos(e.target.value);
    });

    // Cargar primera vez
    cargarDatos("lluvia");
  </script>
</body>
</html>
